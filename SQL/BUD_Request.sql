select activated_by_user_id 
from fonoteka_promocode f 
join promocode_campaign c 
on c.id = f.promocode_campaign_id 
where c.name = ('Zvooq for Bud') 
and f.is_activated = true 
group by activated_by_user_id;

select a.user_id 
from app_subscription a
join fonoteka_promocode f
on a.user_id = f.activated_by_user_id 
join promocode_campaign c
on c.id = f.promocode_campaign_id
where is_trial = false 
    and a.app != 'fonoteka' 
    and a.price > 5 
    and a.platform in ('apple', 'google', 'zvooq')
    and c.name = ('Zvooq for Bud')
    and f.is_activated = true
    and a.added >= to_date(date_add(f.activation, 30))
group by a.user_id
;


select avg (total) 
from (
      select sum (play_duration) as total
      ,p.day
      from playevent p
      join fonoteka_promocode f
      on p.user_id = f.activated_by_user_id 
      where
        f.code in ('1DR19F9', '1K8JF25', '1LXCWYM', '1X33UQF', '23FYQDW', '24YENUP', '25MFKF6', '293U2C1', '2B2BL4S', '2E44UU1', '2HDAUT8', '2HRMK1N', '2VM2LYX', '32RQ7TD', '34EXVJ1', '34EZ2MN', '3BFV9Y5', '3E7DZYH', '3JXB5LF', '3KZVFQK', '3L49Y7G', '3SCR1RW', '3U97CMW', '3WL3V9A', '3ZWRXE2', '42RWH7F', '43C7GDJ', '44N4PK1', '477HFZL', '4A6NXP7', '4HGD717', '4LVRW68', '4M586CK', '4NCCE5A', '4Q8XMQB', '4QFE2WK', '4RTFUB2', '4TUXV15', '4XZ9CVZ', '54G8MNB', '559R7JV', '56JUUK5', '57TQ3DS', '58XYMSP', '59D5ZCR', '5A7MRVR', '5G1L5JU', '5GLN2J6', '5J6M7V7', '5L116GF', '5LDLLMJ', '5NBLLQ1', '5QEDL1T', '5XZVWNY', '62KAUZM', '631EBKE', '6757JG1', '69H6DMK', '6DCC1VU', '6DHFR99', '6PFCV7N', '6RJERGY', '6XEPWQJ', '6YEHF2A', '71XHDTY', '76MUJ1R', '77E327V', '77HEHPN', '7C4CP2C', '7CWQUF6', '7GEC7AC', '7J2UZF1', '7K7T9BD', '7PE3GTL', '7WKK9YZ', '83TS82T', '84FVSBE', '88D1DV3', '88U7Q71', '8DEWHUB', '8HEAPJZ', '8TTX92F', '8TWPVB1', '8V8KZAN', '8XN1YT5', '8YFYLBP', '8YQQ77X', '8Z77HKW', '93AXLVJ', '99FUKQ6', '9BKFW28', '9EXHEEX', '9KB2YJH', '9NMKBUZ', '9PPRK1K', '9VWW4EQ', '9YUA2T4', 'A48NFNS', 'A822SYW', 'AD85TZZ', 'AHNNGUT', 'APAP5P7', 'ASNN4GM', 'BCBHK36', 'BFZZ72S', 'BJ22C2M', 'BKJQRPL', 'BLWXYKT', 'BM9D9HU', 'BRF9Z7U', 'BS3WJ66', 'BWPCBVV', 'BZ144AB', 'BZDBM4V', 'BZF22QB', 'C6MG4SL', 'C6N9VJZ', 'C8RFTM2', 'CFGJLTL', 'CL4Q3JT', 'CSUENUR', 'CSX4ED3', 'D2CZEN7', 'D2P6WM9', 'D8SRRAB', 'D8ZY6H4', 'D9DYEY5', 'DBAFZFD', 'DBZUT52', 'DCLJ64X', 'DHX87NL', 'DU11B9Y', 'DWLXBFB', 'DXXNZ7U', 'E3ERRVW', 'E6CBTA8', 'EC8BFLW', 'EDPJFAR', 'EETSGJQ', 'EQ2GPK2', 'ERM4CLX', 'EYB3HLX', 'EYS17H9', 'F1BM86V', 'F2TF6W5', 'F2W6CPD', 'F5TLCV9', 'F7Q9DE9', 'FFE1V3D', 'FK7G197', 'FNLXTG9', 'FUY4SCR', 'FXP2GUU', 'FXS7TS2', 'G6DGJCN', 'G6WZ3Z9', 'G8KM97M', 'G9YX44K', 'GBZGRY6', 'GEWGFRR', 'GG3VT3J', 'GN24J8M', 'GVCYDY3', 'GWA11TF', 'GYGA1BV', 'H45QTVS', 'H55LNW4', 'HA5E1Y2', 'HDEMFH4', 'HF7ZWQC', 'HJJ4Z37', 'HK2QH5P', 'HMALNBM', 'HPHQFQS', 'HWJASH5', 'J1NHU25', 'J5RYQN9', 'J6SR444', 'J7JY96Y', 'J9BZCMN', 'J9UY97S', 'JCQ9C22', 'JCWT8TH', 'JDU4AS6', 'JE27AR2', 'JF93YXV', 'JK5XY1D', 'JKHCUC1', 'JKHQ6QC', 'JM6AS8L', 'JMHDY9N', 'JNDG8DX', 'JPLDYZF', 'JR8ED87', 'JRMLBYW', 'JS2URCY', 'JSKZTLR', 'JSYDFWV', 'JTBPMBQ', 'JVSGDYU', 'JXUQG4T', 'K4XBQ5F', 'KANTKGZ', 'KG7J484', 'KLNPNZZ', 'KQGK65V', 'KT8NSC6', 'KZKWBXV', 'L6VS66J', 'LCZR5TC', 'LEHBT14', 'LGE1UUP', 'LHC9G3F', 'LRUVMJP', 'LS3E31Y', 'LSBCVD9', 'LTNQXP3', 'LYVSNLU', 'LZ7FYDM', 'LZSV97G', 'M4PCJS4', 'M5GRDF7', 'M69SAUB', 'MDCMLJU', 'ME1P5HP', 'MECC4Y5', 'MHJA174', 'MHZAFG1', 'MPZSAUQ', 'MQEAF7M', 'MRKDKCW', 'MV6LQ6E', 'N1N83KP', 'N65954P', 'N91ZMFK', 'N9UPSPB', 'ND9FJVP', 'NL61WZQ', 'NLC1ANY', 'NLVZN2D', 'NMPSJ6P', 'NUEUXPZ', 'NUHZC7Q', 'NWFFDVL', 'NZMCWJN', 'P2MQZKB', 'P6ETS6W', 'PCE8177', 'PMPL5H9', 'PUT3SXT', 'Q2UE7WK', 'Q4J7UEP', 'QA37C1P', 'QFN8Y4B', 'QKDSZQ6', 'QN4MLL5', 'QUSM82X', 'QVEY4VT', 'QX7LPCQ', 'QXREQ3B', 'RC7KTNK', 'RDS7B73', 'RFRCPK4', 'RH4ET7X', 'RJYGVLU', 'RKLNL15', 'RRJ2T3U', 'RWLQRMB', 'RX2ZKED', 'RX747GV', 'RYZLY7W', 'S2JK3BM', 'S33TGGR', 'S97URHS', 'S9LU3N1', 'SB6DMMV', 'SGGLEHG', 'SKXSKVN', 'SMD8AAC', 'SMVFHSN', 'SNGVWRA', 'SNN56P5', 'SPR6BNY', 'SR4KA4C', 'STC93KY', 'SUYZ8VU', 'SYYEUGK', 'T2AQVAX', 'T9NQGXC', 'TD11V4U', 'TJJUMH1', 'TLL43M5', 'TR51VSJ', 'TSC7CX6', 'U1V7NKC', 'U33NX8S', 'U9XEMPJ', 'UDURF2V', 'UELLB6G', 'UQNJ4PN', 'UT434P2', 'UYTCSHC', 'V23GV7S', 'V9NCCZN', 'VA62TJC', 'VAHGXAT', 'VC7FNUU', 'VCK3RS6', 'VELHHKT', 'VFTHSHR', 'VJXR22M', 'VNEF8XB', 'VQWCLBQ', 'VYAKNAS', 'VZT3Q4C', 'W4Z7KBH', 'W7G2L71', 'W7X9J5T', 'W8BFBFQ', 'WPXHTBM', 'WRNQXJE', 'WVD4APE', 'WWLQBRY', 'WYY6DFC', 'WZJUP51', 'X1V4LVF', 'X1YXFLS', 'X76K25N', 'X88T4K9', 'X98P8LX', 'XL7NXSA', 'XLJ3ZJF', 'XS8KLVJ', 'XT9W25Y', 'XWMQNDF', 'Y38ZJQC', 'Y7XTP7Q', 'Y923Y2B', 'YDSJCSY', 'YJCNAF9', 'YPR9H7D', 'YT99R7N', 'YVYCRK9', 'YYCN9RX', 'YZ5T7M3', 'Z19MPSS', 'Z59NV8M', 'Z7KG7VV', 'ZFL41Z3', 'ZGPUHR7', 'ZJA3MSH', 'ZUK6ZS2', 'ZVE5DBW', 'ZYARL1R')
        and p.day >= to_date(f.activation) 
        and p.day <= to_date(date_add(f.activation, 30))
      group by p.day
     ) a
;

select count(*) as total
, rmeta.genres
from playevent p
join fonoteka_promocode f
on p.user_id = f.activated_by_user_id 
join rmeta 
on rmeta.zrid = p.src_id
where
f.code in ('1DR19F9', '1K8JF25', '1LXCWYM', '1X33UQF', '23FYQDW', '24YENUP', '25MFKF6', '293U2C1', '2B2BL4S', '2E44UU1', '2HDAUT8', '2HRMK1N', '2VM2LYX', '32RQ7TD', '34EXVJ1', '34EZ2MN', '3BFV9Y5', '3E7DZYH', '3JXB5LF', '3KZVFQK', '3L49Y7G', '3SCR1RW', '3U97CMW', '3WL3V9A', '3ZWRXE2', '42RWH7F', '43C7GDJ', '44N4PK1', '477HFZL', '4A6NXP7', '4HGD717', '4LVRW68', '4M586CK', '4NCCE5A', '4Q8XMQB', '4QFE2WK', '4RTFUB2', '4TUXV15', '4XZ9CVZ', '54G8MNB', '559R7JV', '56JUUK5', '57TQ3DS', '58XYMSP', '59D5ZCR', '5A7MRVR', '5G1L5JU', '5GLN2J6', '5J6M7V7', '5L116GF', '5LDLLMJ', '5NBLLQ1', '5QEDL1T', '5XZVWNY', '62KAUZM', '631EBKE', '6757JG1', '69H6DMK', '6DCC1VU', '6DHFR99', '6PFCV7N', '6RJERGY', '6XEPWQJ', '6YEHF2A', '71XHDTY', '76MUJ1R', '77E327V', '77HEHPN', '7C4CP2C', '7CWQUF6', '7GEC7AC', '7J2UZF1', '7K7T9BD', '7PE3GTL', '7WKK9YZ', '83TS82T', '84FVSBE', '88D1DV3', '88U7Q71', '8DEWHUB', '8HEAPJZ', '8TTX92F', '8TWPVB1', '8V8KZAN', '8XN1YT5', '8YFYLBP', '8YQQ77X', '8Z77HKW', '93AXLVJ', '99FUKQ6', '9BKFW28', '9EXHEEX', '9KB2YJH', '9NMKBUZ', '9PPRK1K', '9VWW4EQ', '9YUA2T4', 'A48NFNS', 'A822SYW', 'AD85TZZ', 'AHNNGUT', 'APAP5P7', 'ASNN4GM', 'BCBHK36', 'BFZZ72S', 'BJ22C2M', 'BKJQRPL', 'BLWXYKT', 'BM9D9HU', 'BRF9Z7U', 'BS3WJ66', 'BWPCBVV', 'BZ144AB', 'BZDBM4V', 'BZF22QB', 'C6MG4SL', 'C6N9VJZ', 'C8RFTM2', 'CFGJLTL', 'CL4Q3JT', 'CSUENUR', 'CSX4ED3', 'D2CZEN7', 'D2P6WM9', 'D8SRRAB', 'D8ZY6H4', 'D9DYEY5', 'DBAFZFD', 'DBZUT52', 'DCLJ64X', 'DHX87NL', 'DU11B9Y', 'DWLXBFB', 'DXXNZ7U', 'E3ERRVW', 'E6CBTA8', 'EC8BFLW', 'EDPJFAR', 'EETSGJQ', 'EQ2GPK2', 'ERM4CLX', 'EYB3HLX', 'EYS17H9', 'F1BM86V', 'F2TF6W5', 'F2W6CPD', 'F5TLCV9', 'F7Q9DE9', 'FFE1V3D', 'FK7G197', 'FNLXTG9', 'FUY4SCR', 'FXP2GUU', 'FXS7TS2', 'G6DGJCN', 'G6WZ3Z9', 'G8KM97M', 'G9YX44K', 'GBZGRY6', 'GEWGFRR', 'GG3VT3J', 'GN24J8M', 'GVCYDY3', 'GWA11TF', 'GYGA1BV', 'H45QTVS', 'H55LNW4', 'HA5E1Y2', 'HDEMFH4', 'HF7ZWQC', 'HJJ4Z37', 'HK2QH5P', 'HMALNBM', 'HPHQFQS', 'HWJASH5', 'J1NHU25', 'J5RYQN9', 'J6SR444', 'J7JY96Y', 'J9BZCMN', 'J9UY97S', 'JCQ9C22', 'JCWT8TH', 'JDU4AS6', 'JE27AR2', 'JF93YXV', 'JK5XY1D', 'JKHCUC1', 'JKHQ6QC', 'JM6AS8L', 'JMHDY9N', 'JNDG8DX', 'JPLDYZF', 'JR8ED87', 'JRMLBYW', 'JS2URCY', 'JSKZTLR', 'JSYDFWV', 'JTBPMBQ', 'JVSGDYU', 'JXUQG4T', 'K4XBQ5F', 'KANTKGZ', 'KG7J484', 'KLNPNZZ', 'KQGK65V', 'KT8NSC6', 'KZKWBXV', 'L6VS66J', 'LCZR5TC', 'LEHBT14', 'LGE1UUP', 'LHC9G3F', 'LRUVMJP', 'LS3E31Y', 'LSBCVD9', 'LTNQXP3', 'LYVSNLU', 'LZ7FYDM', 'LZSV97G', 'M4PCJS4', 'M5GRDF7', 'M69SAUB', 'MDCMLJU', 'ME1P5HP', 'MECC4Y5', 'MHJA174', 'MHZAFG1', 'MPZSAUQ', 'MQEAF7M', 'MRKDKCW', 'MV6LQ6E', 'N1N83KP', 'N65954P', 'N91ZMFK', 'N9UPSPB', 'ND9FJVP', 'NL61WZQ', 'NLC1ANY', 'NLVZN2D', 'NMPSJ6P', 'NUEUXPZ', 'NUHZC7Q', 'NWFFDVL', 'NZMCWJN', 'P2MQZKB', 'P6ETS6W', 'PCE8177', 'PMPL5H9', 'PUT3SXT', 'Q2UE7WK', 'Q4J7UEP', 'QA37C1P', 'QFN8Y4B', 'QKDSZQ6', 'QN4MLL5', 'QUSM82X', 'QVEY4VT', 'QX7LPCQ', 'QXREQ3B', 'RC7KTNK', 'RDS7B73', 'RFRCPK4', 'RH4ET7X', 'RJYGVLU', 'RKLNL15', 'RRJ2T3U', 'RWLQRMB', 'RX2ZKED', 'RX747GV', 'RYZLY7W', 'S2JK3BM', 'S33TGGR', 'S97URHS', 'S9LU3N1', 'SB6DMMV', 'SGGLEHG', 'SKXSKVN', 'SMD8AAC', 'SMVFHSN', 'SNGVWRA', 'SNN56P5', 'SPR6BNY', 'SR4KA4C', 'STC93KY', 'SUYZ8VU', 'SYYEUGK', 'T2AQVAX', 'T9NQGXC', 'TD11V4U', 'TJJUMH1', 'TLL43M5', 'TR51VSJ', 'TSC7CX6', 'U1V7NKC', 'U33NX8S', 'U9XEMPJ', 'UDURF2V', 'UELLB6G', 'UQNJ4PN', 'UT434P2', 'UYTCSHC', 'V23GV7S', 'V9NCCZN', 'VA62TJC', 'VAHGXAT', 'VC7FNUU', 'VCK3RS6', 'VELHHKT', 'VFTHSHR', 'VJXR22M', 'VNEF8XB', 'VQWCLBQ', 'VYAKNAS', 'VZT3Q4C', 'W4Z7KBH', 'W7G2L71', 'W7X9J5T', 'W8BFBFQ', 'WPXHTBM', 'WRNQXJE', 'WVD4APE', 'WWLQBRY', 'WYY6DFC', 'WZJUP51', 'X1V4LVF', 'X1YXFLS', 'X76K25N', 'X88T4K9', 'X98P8LX', 'XL7NXSA', 'XLJ3ZJF', 'XS8KLVJ', 'XT9W25Y', 'XWMQNDF', 'Y38ZJQC', 'Y7XTP7Q', 'Y923Y2B', 'YDSJCSY', 'YJCNAF9', 'YPR9H7D', 'YT99R7N', 'YVYCRK9', 'YYCN9RX', 'YZ5T7M3', 'Z19MPSS', 'Z59NV8M', 'Z7KG7VV', 'ZFL41Z3', 'ZGPUHR7', 'ZJA3MSH', 'ZUK6ZS2', 'ZVE5DBW', 'ZYARL1R')
  and p.day >= to_date(f.activation) 
  and p.day <= to_date(date_add(f.activation, 30))
group by rmeta.genres
order by total desc limit 10
;

select count(*) as total
, track.title
, tcredits.credits
from playevent p
join fonoteka_promocode f
on p.user_id = f.activated_by_user_id 
join track
on track.id = p.src_id
join tcredits
on p.track_id = tcredits.ztid
where
f.code in ('1DR19F9', '1K8JF25', '1LXCWYM', '1X33UQF', '23FYQDW', '24YENUP', '25MFKF6', '293U2C1', '2B2BL4S', '2E44UU1', '2HDAUT8', '2HRMK1N', '2VM2LYX', '32RQ7TD', '34EXVJ1', '34EZ2MN', '3BFV9Y5', '3E7DZYH', '3JXB5LF', '3KZVFQK', '3L49Y7G', '3SCR1RW', '3U97CMW', '3WL3V9A', '3ZWRXE2', '42RWH7F', '43C7GDJ', '44N4PK1', '477HFZL', '4A6NXP7', '4HGD717', '4LVRW68', '4M586CK', '4NCCE5A', '4Q8XMQB', '4QFE2WK', '4RTFUB2', '4TUXV15', '4XZ9CVZ', '54G8MNB', '559R7JV', '56JUUK5', '57TQ3DS', '58XYMSP', '59D5ZCR', '5A7MRVR', '5G1L5JU', '5GLN2J6', '5J6M7V7', '5L116GF', '5LDLLMJ', '5NBLLQ1', '5QEDL1T', '5XZVWNY', '62KAUZM', '631EBKE', '6757JG1', '69H6DMK', '6DCC1VU', '6DHFR99', '6PFCV7N', '6RJERGY', '6XEPWQJ', '6YEHF2A', '71XHDTY', '76MUJ1R', '77E327V', '77HEHPN', '7C4CP2C', '7CWQUF6', '7GEC7AC', '7J2UZF1', '7K7T9BD', '7PE3GTL', '7WKK9YZ', '83TS82T', '84FVSBE', '88D1DV3', '88U7Q71', '8DEWHUB', '8HEAPJZ', '8TTX92F', '8TWPVB1', '8V8KZAN', '8XN1YT5', '8YFYLBP', '8YQQ77X', '8Z77HKW', '93AXLVJ', '99FUKQ6', '9BKFW28', '9EXHEEX', '9KB2YJH', '9NMKBUZ', '9PPRK1K', '9VWW4EQ', '9YUA2T4', 'A48NFNS', 'A822SYW', 'AD85TZZ', 'AHNNGUT', 'APAP5P7', 'ASNN4GM', 'BCBHK36', 'BFZZ72S', 'BJ22C2M', 'BKJQRPL', 'BLWXYKT', 'BM9D9HU', 'BRF9Z7U', 'BS3WJ66', 'BWPCBVV', 'BZ144AB', 'BZDBM4V', 'BZF22QB', 'C6MG4SL', 'C6N9VJZ', 'C8RFTM2', 'CFGJLTL', 'CL4Q3JT', 'CSUENUR', 'CSX4ED3', 'D2CZEN7', 'D2P6WM9', 'D8SRRAB', 'D8ZY6H4', 'D9DYEY5', 'DBAFZFD', 'DBZUT52', 'DCLJ64X', 'DHX87NL', 'DU11B9Y', 'DWLXBFB', 'DXXNZ7U', 'E3ERRVW', 'E6CBTA8', 'EC8BFLW', 'EDPJFAR', 'EETSGJQ', 'EQ2GPK2', 'ERM4CLX', 'EYB3HLX', 'EYS17H9', 'F1BM86V', 'F2TF6W5', 'F2W6CPD', 'F5TLCV9', 'F7Q9DE9', 'FFE1V3D', 'FK7G197', 'FNLXTG9', 'FUY4SCR', 'FXP2GUU', 'FXS7TS2', 'G6DGJCN', 'G6WZ3Z9', 'G8KM97M', 'G9YX44K', 'GBZGRY6', 'GEWGFRR', 'GG3VT3J', 'GN24J8M', 'GVCYDY3', 'GWA11TF', 'GYGA1BV', 'H45QTVS', 'H55LNW4', 'HA5E1Y2', 'HDEMFH4', 'HF7ZWQC', 'HJJ4Z37', 'HK2QH5P', 'HMALNBM', 'HPHQFQS', 'HWJASH5', 'J1NHU25', 'J5RYQN9', 'J6SR444', 'J7JY96Y', 'J9BZCMN', 'J9UY97S', 'JCQ9C22', 'JCWT8TH', 'JDU4AS6', 'JE27AR2', 'JF93YXV', 'JK5XY1D', 'JKHCUC1', 'JKHQ6QC', 'JM6AS8L', 'JMHDY9N', 'JNDG8DX', 'JPLDYZF', 'JR8ED87', 'JRMLBYW', 'JS2URCY', 'JSKZTLR', 'JSYDFWV', 'JTBPMBQ', 'JVSGDYU', 'JXUQG4T', 'K4XBQ5F', 'KANTKGZ', 'KG7J484', 'KLNPNZZ', 'KQGK65V', 'KT8NSC6', 'KZKWBXV', 'L6VS66J', 'LCZR5TC', 'LEHBT14', 'LGE1UUP', 'LHC9G3F', 'LRUVMJP', 'LS3E31Y', 'LSBCVD9', 'LTNQXP3', 'LYVSNLU', 'LZ7FYDM', 'LZSV97G', 'M4PCJS4', 'M5GRDF7', 'M69SAUB', 'MDCMLJU', 'ME1P5HP', 'MECC4Y5', 'MHJA174', 'MHZAFG1', 'MPZSAUQ', 'MQEAF7M', 'MRKDKCW', 'MV6LQ6E', 'N1N83KP', 'N65954P', 'N91ZMFK', 'N9UPSPB', 'ND9FJVP', 'NL61WZQ', 'NLC1ANY', 'NLVZN2D', 'NMPSJ6P', 'NUEUXPZ', 'NUHZC7Q', 'NWFFDVL', 'NZMCWJN', 'P2MQZKB', 'P6ETS6W', 'PCE8177', 'PMPL5H9', 'PUT3SXT', 'Q2UE7WK', 'Q4J7UEP', 'QA37C1P', 'QFN8Y4B', 'QKDSZQ6', 'QN4MLL5', 'QUSM82X', 'QVEY4VT', 'QX7LPCQ', 'QXREQ3B', 'RC7KTNK', 'RDS7B73', 'RFRCPK4', 'RH4ET7X', 'RJYGVLU', 'RKLNL15', 'RRJ2T3U', 'RWLQRMB', 'RX2ZKED', 'RX747GV', 'RYZLY7W', 'S2JK3BM', 'S33TGGR', 'S97URHS', 'S9LU3N1', 'SB6DMMV', 'SGGLEHG', 'SKXSKVN', 'SMD8AAC', 'SMVFHSN', 'SNGVWRA', 'SNN56P5', 'SPR6BNY', 'SR4KA4C', 'STC93KY', 'SUYZ8VU', 'SYYEUGK', 'T2AQVAX', 'T9NQGXC', 'TD11V4U', 'TJJUMH1', 'TLL43M5', 'TR51VSJ', 'TSC7CX6', 'U1V7NKC', 'U33NX8S', 'U9XEMPJ', 'UDURF2V', 'UELLB6G', 'UQNJ4PN', 'UT434P2', 'UYTCSHC', 'V23GV7S', 'V9NCCZN', 'VA62TJC', 'VAHGXAT', 'VC7FNUU', 'VCK3RS6', 'VELHHKT', 'VFTHSHR', 'VJXR22M', 'VNEF8XB', 'VQWCLBQ', 'VYAKNAS', 'VZT3Q4C', 'W4Z7KBH', 'W7G2L71', 'W7X9J5T', 'W8BFBFQ', 'WPXHTBM', 'WRNQXJE', 'WVD4APE', 'WWLQBRY', 'WYY6DFC', 'WZJUP51', 'X1V4LVF', 'X1YXFLS', 'X76K25N', 'X88T4K9', 'X98P8LX', 'XL7NXSA', 'XLJ3ZJF', 'XS8KLVJ', 'XT9W25Y', 'XWMQNDF', 'Y38ZJQC', 'Y7XTP7Q', 'Y923Y2B', 'YDSJCSY', 'YJCNAF9', 'YPR9H7D', 'YT99R7N', 'YVYCRK9', 'YYCN9RX', 'YZ5T7M3', 'Z19MPSS', 'Z59NV8M', 'Z7KG7VV', 'ZFL41Z3', 'ZGPUHR7', 'ZJA3MSH', 'ZUK6ZS2', 'ZVE5DBW', 'ZYARL1R')
  and p.day >= to_date(f.activation) 
  and p.day <= to_date(date_add(f.activation, 30))
group by track.title, tcredits.credits
order by total desc limit 10
;


select sum(p.play_duration) total
from playevent p
join fonoteka_promocode f
on p.user_id = f.activated_by_user_id 
where
  f.code in ('1DR19F9', '1K8JF25', '1LXCWYM', '1X33UQF', '23FYQDW', '24YENUP', '25MFKF6', '293U2C1', '2B2BL4S', '2E44UU1', '2HDAUT8', '2HRMK1N', '2VM2LYX', '32RQ7TD', '34EXVJ1', '34EZ2MN', '3BFV9Y5', '3E7DZYH', '3JXB5LF', '3KZVFQK', '3L49Y7G', '3SCR1RW', '3U97CMW', '3WL3V9A', '3ZWRXE2', '42RWH7F', '43C7GDJ', '44N4PK1', '477HFZL', '4A6NXP7', '4HGD717', '4LVRW68', '4M586CK', '4NCCE5A', '4Q8XMQB', '4QFE2WK', '4RTFUB2', '4TUXV15', '4XZ9CVZ', '54G8MNB', '559R7JV', '56JUUK5', '57TQ3DS', '58XYMSP', '59D5ZCR', '5A7MRVR', '5G1L5JU', '5GLN2J6', '5J6M7V7', '5L116GF', '5LDLLMJ', '5NBLLQ1', '5QEDL1T', '5XZVWNY', '62KAUZM', '631EBKE', '6757JG1', '69H6DMK', '6DCC1VU', '6DHFR99', '6PFCV7N', '6RJERGY', '6XEPWQJ', '6YEHF2A', '71XHDTY', '76MUJ1R', '77E327V', '77HEHPN', '7C4CP2C', '7CWQUF6', '7GEC7AC', '7J2UZF1', '7K7T9BD', '7PE3GTL', '7WKK9YZ', '83TS82T', '84FVSBE', '88D1DV3', '88U7Q71', '8DEWHUB', '8HEAPJZ', '8TTX92F', '8TWPVB1', '8V8KZAN', '8XN1YT5', '8YFYLBP', '8YQQ77X', '8Z77HKW', '93AXLVJ', '99FUKQ6', '9BKFW28', '9EXHEEX', '9KB2YJH', '9NMKBUZ', '9PPRK1K', '9VWW4EQ', '9YUA2T4', 'A48NFNS', 'A822SYW', 'AD85TZZ', 'AHNNGUT', 'APAP5P7', 'ASNN4GM', 'BCBHK36', 'BFZZ72S', 'BJ22C2M', 'BKJQRPL', 'BLWXYKT', 'BM9D9HU', 'BRF9Z7U', 'BS3WJ66', 'BWPCBVV', 'BZ144AB', 'BZDBM4V', 'BZF22QB', 'C6MG4SL', 'C6N9VJZ', 'C8RFTM2', 'CFGJLTL', 'CL4Q3JT', 'CSUENUR', 'CSX4ED3', 'D2CZEN7', 'D2P6WM9', 'D8SRRAB', 'D8ZY6H4', 'D9DYEY5', 'DBAFZFD', 'DBZUT52', 'DCLJ64X', 'DHX87NL', 'DU11B9Y', 'DWLXBFB', 'DXXNZ7U', 'E3ERRVW', 'E6CBTA8', 'EC8BFLW', 'EDPJFAR', 'EETSGJQ', 'EQ2GPK2', 'ERM4CLX', 'EYB3HLX', 'EYS17H9', 'F1BM86V', 'F2TF6W5', 'F2W6CPD', 'F5TLCV9', 'F7Q9DE9', 'FFE1V3D', 'FK7G197', 'FNLXTG9', 'FUY4SCR', 'FXP2GUU', 'FXS7TS2', 'G6DGJCN', 'G6WZ3Z9', 'G8KM97M', 'G9YX44K', 'GBZGRY6', 'GEWGFRR', 'GG3VT3J', 'GN24J8M', 'GVCYDY3', 'GWA11TF', 'GYGA1BV', 'H45QTVS', 'H55LNW4', 'HA5E1Y2', 'HDEMFH4', 'HF7ZWQC', 'HJJ4Z37', 'HK2QH5P', 'HMALNBM', 'HPHQFQS', 'HWJASH5', 'J1NHU25', 'J5RYQN9', 'J6SR444', 'J7JY96Y', 'J9BZCMN', 'J9UY97S', 'JCQ9C22', 'JCWT8TH', 'JDU4AS6', 'JE27AR2', 'JF93YXV', 'JK5XY1D', 'JKHCUC1', 'JKHQ6QC', 'JM6AS8L', 'JMHDY9N', 'JNDG8DX', 'JPLDYZF', 'JR8ED87', 'JRMLBYW', 'JS2URCY', 'JSKZTLR', 'JSYDFWV', 'JTBPMBQ', 'JVSGDYU', 'JXUQG4T', 'K4XBQ5F', 'KANTKGZ', 'KG7J484', 'KLNPNZZ', 'KQGK65V', 'KT8NSC6', 'KZKWBXV', 'L6VS66J', 'LCZR5TC', 'LEHBT14', 'LGE1UUP', 'LHC9G3F', 'LRUVMJP', 'LS3E31Y', 'LSBCVD9', 'LTNQXP3', 'LYVSNLU', 'LZ7FYDM', 'LZSV97G', 'M4PCJS4', 'M5GRDF7', 'M69SAUB', 'MDCMLJU', 'ME1P5HP', 'MECC4Y5', 'MHJA174', 'MHZAFG1', 'MPZSAUQ', 'MQEAF7M', 'MRKDKCW', 'MV6LQ6E', 'N1N83KP', 'N65954P', 'N91ZMFK', 'N9UPSPB', 'ND9FJVP', 'NL61WZQ', 'NLC1ANY', 'NLVZN2D', 'NMPSJ6P', 'NUEUXPZ', 'NUHZC7Q', 'NWFFDVL', 'NZMCWJN', 'P2MQZKB', 'P6ETS6W', 'PCE8177', 'PMPL5H9', 'PUT3SXT', 'Q2UE7WK', 'Q4J7UEP', 'QA37C1P', 'QFN8Y4B', 'QKDSZQ6', 'QN4MLL5', 'QUSM82X', 'QVEY4VT', 'QX7LPCQ', 'QXREQ3B', 'RC7KTNK', 'RDS7B73', 'RFRCPK4', 'RH4ET7X', 'RJYGVLU', 'RKLNL15', 'RRJ2T3U', 'RWLQRMB', 'RX2ZKED', 'RX747GV', 'RYZLY7W', 'S2JK3BM', 'S33TGGR', 'S97URHS', 'S9LU3N1', 'SB6DMMV', 'SGGLEHG', 'SKXSKVN', 'SMD8AAC', 'SMVFHSN', 'SNGVWRA', 'SNN56P5', 'SPR6BNY', 'SR4KA4C', 'STC93KY', 'SUYZ8VU', 'SYYEUGK', 'T2AQVAX', 'T9NQGXC', 'TD11V4U', 'TJJUMH1', 'TLL43M5', 'TR51VSJ', 'TSC7CX6', 'U1V7NKC', 'U33NX8S', 'U9XEMPJ', 'UDURF2V', 'UELLB6G', 'UQNJ4PN', 'UT434P2', 'UYTCSHC', 'V23GV7S', 'V9NCCZN', 'VA62TJC', 'VAHGXAT', 'VC7FNUU', 'VCK3RS6', 'VELHHKT', 'VFTHSHR', 'VJXR22M', 'VNEF8XB', 'VQWCLBQ', 'VYAKNAS', 'VZT3Q4C', 'W4Z7KBH', 'W7G2L71', 'W7X9J5T', 'W8BFBFQ', 'WPXHTBM', 'WRNQXJE', 'WVD4APE', 'WWLQBRY', 'WYY6DFC', 'WZJUP51', 'X1V4LVF', 'X1YXFLS', 'X76K25N', 'X88T4K9', 'X98P8LX', 'XL7NXSA', 'XLJ3ZJF', 'XS8KLVJ', 'XT9W25Y', 'XWMQNDF', 'Y38ZJQC', 'Y7XTP7Q', 'Y923Y2B', 'YDSJCSY', 'YJCNAF9', 'YPR9H7D', 'YT99R7N', 'YVYCRK9', 'YYCN9RX', 'YZ5T7M3', 'Z19MPSS', 'Z59NV8M', 'Z7KG7VV', 'ZFL41Z3', 'ZGPUHR7', 'ZJA3MSH', 'ZUK6ZS2', 'ZVE5DBW', 'ZYARL1R')
  and p.day >= to_date(f.activation) 
  and p.day <= to_date(date_add(f.activation, 30))
  and p.app = 'openplay'
;

select count(*) as total
, release.title
, release.id
from playevent p
join fonoteka_promocode f
on p.user_id = f.activated_by_user_id 
join release 
on release.id = p.src_id
join 
(
    select item_id & -9151314442816847873 as fav
    from library 
    where floor(item_id/power(2,56)) = 6
) lib
on lib.fav = release.id
where src_type = 'release'
  and f.code in ('1DR19F9', '1K8JF25', '1LXCWYM', '1X33UQF', '23FYQDW', '24YENUP', '25MFKF6', '293U2C1', '2B2BL4S', '2E44UU1', '2HDAUT8', '2HRMK1N', '2VM2LYX', '32RQ7TD', '34EXVJ1', '34EZ2MN', '3BFV9Y5', '3E7DZYH', '3JXB5LF', '3KZVFQK', '3L49Y7G', '3SCR1RW', '3U97CMW', '3WL3V9A', '3ZWRXE2', '42RWH7F', '43C7GDJ', '44N4PK1', '477HFZL', '4A6NXP7', '4HGD717', '4LVRW68', '4M586CK', '4NCCE5A', '4Q8XMQB', '4QFE2WK', '4RTFUB2', '4TUXV15', '4XZ9CVZ', '54G8MNB', '559R7JV', '56JUUK5', '57TQ3DS', '58XYMSP', '59D5ZCR', '5A7MRVR', '5G1L5JU', '5GLN2J6', '5J6M7V7', '5L116GF', '5LDLLMJ', '5NBLLQ1', '5QEDL1T', '5XZVWNY', '62KAUZM', '631EBKE', '6757JG1', '69H6DMK', '6DCC1VU', '6DHFR99', '6PFCV7N', '6RJERGY', '6XEPWQJ', '6YEHF2A', '71XHDTY', '76MUJ1R', '77E327V', '77HEHPN', '7C4CP2C', '7CWQUF6', '7GEC7AC', '7J2UZF1', '7K7T9BD', '7PE3GTL', '7WKK9YZ', '83TS82T', '84FVSBE', '88D1DV3', '88U7Q71', '8DEWHUB', '8HEAPJZ', '8TTX92F', '8TWPVB1', '8V8KZAN', '8XN1YT5', '8YFYLBP', '8YQQ77X', '8Z77HKW', '93AXLVJ', '99FUKQ6', '9BKFW28', '9EXHEEX', '9KB2YJH', '9NMKBUZ', '9PPRK1K', '9VWW4EQ', '9YUA2T4', 'A48NFNS', 'A822SYW', 'AD85TZZ', 'AHNNGUT', 'APAP5P7', 'ASNN4GM', 'BCBHK36', 'BFZZ72S', 'BJ22C2M', 'BKJQRPL', 'BLWXYKT', 'BM9D9HU', 'BRF9Z7U', 'BS3WJ66', 'BWPCBVV', 'BZ144AB', 'BZDBM4V', 'BZF22QB', 'C6MG4SL', 'C6N9VJZ', 'C8RFTM2', 'CFGJLTL', 'CL4Q3JT', 'CSUENUR', 'CSX4ED3', 'D2CZEN7', 'D2P6WM9', 'D8SRRAB', 'D8ZY6H4', 'D9DYEY5', 'DBAFZFD', 'DBZUT52', 'DCLJ64X', 'DHX87NL', 'DU11B9Y', 'DWLXBFB', 'DXXNZ7U', 'E3ERRVW', 'E6CBTA8', 'EC8BFLW', 'EDPJFAR', 'EETSGJQ', 'EQ2GPK2', 'ERM4CLX', 'EYB3HLX', 'EYS17H9', 'F1BM86V', 'F2TF6W5', 'F2W6CPD', 'F5TLCV9', 'F7Q9DE9', 'FFE1V3D', 'FK7G197', 'FNLXTG9', 'FUY4SCR', 'FXP2GUU', 'FXS7TS2', 'G6DGJCN', 'G6WZ3Z9', 'G8KM97M', 'G9YX44K', 'GBZGRY6', 'GEWGFRR', 'GG3VT3J', 'GN24J8M', 'GVCYDY3', 'GWA11TF', 'GYGA1BV', 'H45QTVS', 'H55LNW4', 'HA5E1Y2', 'HDEMFH4', 'HF7ZWQC', 'HJJ4Z37', 'HK2QH5P', 'HMALNBM', 'HPHQFQS', 'HWJASH5', 'J1NHU25', 'J5RYQN9', 'J6SR444', 'J7JY96Y', 'J9BZCMN', 'J9UY97S', 'JCQ9C22', 'JCWT8TH', 'JDU4AS6', 'JE27AR2', 'JF93YXV', 'JK5XY1D', 'JKHCUC1', 'JKHQ6QC', 'JM6AS8L', 'JMHDY9N', 'JNDG8DX', 'JPLDYZF', 'JR8ED87', 'JRMLBYW', 'JS2URCY', 'JSKZTLR', 'JSYDFWV', 'JTBPMBQ', 'JVSGDYU', 'JXUQG4T', 'K4XBQ5F', 'KANTKGZ', 'KG7J484', 'KLNPNZZ', 'KQGK65V', 'KT8NSC6', 'KZKWBXV', 'L6VS66J', 'LCZR5TC', 'LEHBT14', 'LGE1UUP', 'LHC9G3F', 'LRUVMJP', 'LS3E31Y', 'LSBCVD9', 'LTNQXP3', 'LYVSNLU', 'LZ7FYDM', 'LZSV97G', 'M4PCJS4', 'M5GRDF7', 'M69SAUB', 'MDCMLJU', 'ME1P5HP', 'MECC4Y5', 'MHJA174', 'MHZAFG1', 'MPZSAUQ', 'MQEAF7M', 'MRKDKCW', 'MV6LQ6E', 'N1N83KP', 'N65954P', 'N91ZMFK', 'N9UPSPB', 'ND9FJVP', 'NL61WZQ', 'NLC1ANY', 'NLVZN2D', 'NMPSJ6P', 'NUEUXPZ', 'NUHZC7Q', 'NWFFDVL', 'NZMCWJN', 'P2MQZKB', 'P6ETS6W', 'PCE8177', 'PMPL5H9', 'PUT3SXT', 'Q2UE7WK', 'Q4J7UEP', 'QA37C1P', 'QFN8Y4B', 'QKDSZQ6', 'QN4MLL5', 'QUSM82X', 'QVEY4VT', 'QX7LPCQ', 'QXREQ3B', 'RC7KTNK', 'RDS7B73', 'RFRCPK4', 'RH4ET7X', 'RJYGVLU', 'RKLNL15', 'RRJ2T3U', 'RWLQRMB', 'RX2ZKED', 'RX747GV', 'RYZLY7W', 'S2JK3BM', 'S33TGGR', 'S97URHS', 'S9LU3N1', 'SB6DMMV', 'SGGLEHG', 'SKXSKVN', 'SMD8AAC', 'SMVFHSN', 'SNGVWRA', 'SNN56P5', 'SPR6BNY', 'SR4KA4C', 'STC93KY', 'SUYZ8VU', 'SYYEUGK', 'T2AQVAX', 'T9NQGXC', 'TD11V4U', 'TJJUMH1', 'TLL43M5', 'TR51VSJ', 'TSC7CX6', 'U1V7NKC', 'U33NX8S', 'U9XEMPJ', 'UDURF2V', 'UELLB6G', 'UQNJ4PN', 'UT434P2', 'UYTCSHC', 'V23GV7S', 'V9NCCZN', 'VA62TJC', 'VAHGXAT', 'VC7FNUU', 'VCK3RS6', 'VELHHKT', 'VFTHSHR', 'VJXR22M', 'VNEF8XB', 'VQWCLBQ', 'VYAKNAS', 'VZT3Q4C', 'W4Z7KBH', 'W7G2L71', 'W7X9J5T', 'W8BFBFQ', 'WPXHTBM', 'WRNQXJE', 'WVD4APE', 'WWLQBRY', 'WYY6DFC', 'WZJUP51', 'X1V4LVF', 'X1YXFLS', 'X76K25N', 'X88T4K9', 'X98P8LX', 'XL7NXSA', 'XLJ3ZJF', 'XS8KLVJ', 'XT9W25Y', 'XWMQNDF', 'Y38ZJQC', 'Y7XTP7Q', 'Y923Y2B', 'YDSJCSY', 'YJCNAF9', 'YPR9H7D', 'YT99R7N', 'YVYCRK9', 'YYCN9RX', 'YZ5T7M3', 'Z19MPSS', 'Z59NV8M', 'Z7KG7VV', 'ZFL41Z3', 'ZGPUHR7', 'ZJA3MSH', 'ZUK6ZS2', 'ZVE5DBW', 'ZYARL1R')
  and p.day >= to_date(f.activation) 
  and p.day <= to_date(date_add(f.activation, 30))
group by release.title, release.id
order by total desc limit 10
;


      select distinct user_id
      , u.gender
      , u.location
      , age (u.birthday)
      , u.is_vkontakte_user
      , u.is_facebook_user
      from playevent p
      join fonoteka_promocode f
      on p.user_id = f.activated_by_user_id 
      join u 
      on p.user_id = u.zuid
      where
        f.code in ('1DR19F9', '1K8JF25', '1LXCWYM', '1X33UQF', '23FYQDW', '24YENUP', '25MFKF6', '293U2C1', '2B2BL4S', '2E44UU1', '2HDAUT8', '2HRMK1N', '2VM2LYX', '32RQ7TD', '34EXVJ1', '34EZ2MN', '3BFV9Y5', '3E7DZYH', '3JXB5LF', '3KZVFQK', '3L49Y7G', '3SCR1RW', '3U97CMW', '3WL3V9A', '3ZWRXE2', '42RWH7F', '43C7GDJ', '44N4PK1', '477HFZL', '4A6NXP7', '4HGD717', '4LVRW68', '4M586CK', '4NCCE5A', '4Q8XMQB', '4QFE2WK', '4RTFUB2', '4TUXV15', '4XZ9CVZ', '54G8MNB', '559R7JV', '56JUUK5', '57TQ3DS', '58XYMSP', '59D5ZCR', '5A7MRVR', '5G1L5JU', '5GLN2J6', '5J6M7V7', '5L116GF', '5LDLLMJ', '5NBLLQ1', '5QEDL1T', '5XZVWNY', '62KAUZM', '631EBKE', '6757JG1', '69H6DMK', '6DCC1VU', '6DHFR99', '6PFCV7N', '6RJERGY', '6XEPWQJ', '6YEHF2A', '71XHDTY', '76MUJ1R', '77E327V', '77HEHPN', '7C4CP2C', '7CWQUF6', '7GEC7AC', '7J2UZF1', '7K7T9BD', '7PE3GTL', '7WKK9YZ', '83TS82T', '84FVSBE', '88D1DV3', '88U7Q71', '8DEWHUB', '8HEAPJZ', '8TTX92F', '8TWPVB1', '8V8KZAN', '8XN1YT5', '8YFYLBP', '8YQQ77X', '8Z77HKW', '93AXLVJ', '99FUKQ6', '9BKFW28', '9EXHEEX', '9KB2YJH', '9NMKBUZ', '9PPRK1K', '9VWW4EQ', '9YUA2T4', 'A48NFNS', 'A822SYW', 'AD85TZZ', 'AHNNGUT', 'APAP5P7', 'ASNN4GM', 'BCBHK36', 'BFZZ72S', 'BJ22C2M', 'BKJQRPL', 'BLWXYKT', 'BM9D9HU', 'BRF9Z7U', 'BS3WJ66', 'BWPCBVV', 'BZ144AB', 'BZDBM4V', 'BZF22QB', 'C6MG4SL', 'C6N9VJZ', 'C8RFTM2', 'CFGJLTL', 'CL4Q3JT', 'CSUENUR', 'CSX4ED3', 'D2CZEN7', 'D2P6WM9', 'D8SRRAB', 'D8ZY6H4', 'D9DYEY5', 'DBAFZFD', 'DBZUT52', 'DCLJ64X', 'DHX87NL', 'DU11B9Y', 'DWLXBFB', 'DXXNZ7U', 'E3ERRVW', 'E6CBTA8', 'EC8BFLW', 'EDPJFAR', 'EETSGJQ', 'EQ2GPK2', 'ERM4CLX', 'EYB3HLX', 'EYS17H9', 'F1BM86V', 'F2TF6W5', 'F2W6CPD', 'F5TLCV9', 'F7Q9DE9', 'FFE1V3D', 'FK7G197', 'FNLXTG9', 'FUY4SCR', 'FXP2GUU', 'FXS7TS2', 'G6DGJCN', 'G6WZ3Z9', 'G8KM97M', 'G9YX44K', 'GBZGRY6', 'GEWGFRR', 'GG3VT3J', 'GN24J8M', 'GVCYDY3', 'GWA11TF', 'GYGA1BV', 'H45QTVS', 'H55LNW4', 'HA5E1Y2', 'HDEMFH4', 'HF7ZWQC', 'HJJ4Z37', 'HK2QH5P', 'HMALNBM', 'HPHQFQS', 'HWJASH5', 'J1NHU25', 'J5RYQN9', 'J6SR444', 'J7JY96Y', 'J9BZCMN', 'J9UY97S', 'JCQ9C22', 'JCWT8TH', 'JDU4AS6', 'JE27AR2', 'JF93YXV', 'JK5XY1D', 'JKHCUC1', 'JKHQ6QC', 'JM6AS8L', 'JMHDY9N', 'JNDG8DX', 'JPLDYZF', 'JR8ED87', 'JRMLBYW', 'JS2URCY', 'JSKZTLR', 'JSYDFWV', 'JTBPMBQ', 'JVSGDYU', 'JXUQG4T', 'K4XBQ5F', 'KANTKGZ', 'KG7J484', 'KLNPNZZ', 'KQGK65V', 'KT8NSC6', 'KZKWBXV', 'L6VS66J', 'LCZR5TC', 'LEHBT14', 'LGE1UUP', 'LHC9G3F', 'LRUVMJP', 'LS3E31Y', 'LSBCVD9', 'LTNQXP3', 'LYVSNLU', 'LZ7FYDM', 'LZSV97G', 'M4PCJS4', 'M5GRDF7', 'M69SAUB', 'MDCMLJU', 'ME1P5HP', 'MECC4Y5', 'MHJA174', 'MHZAFG1', 'MPZSAUQ', 'MQEAF7M', 'MRKDKCW', 'MV6LQ6E', 'N1N83KP', 'N65954P', 'N91ZMFK', 'N9UPSPB', 'ND9FJVP', 'NL61WZQ', 'NLC1ANY', 'NLVZN2D', 'NMPSJ6P', 'NUEUXPZ', 'NUHZC7Q', 'NWFFDVL', 'NZMCWJN', 'P2MQZKB', 'P6ETS6W', 'PCE8177', 'PMPL5H9', 'PUT3SXT', 'Q2UE7WK', 'Q4J7UEP', 'QA37C1P', 'QFN8Y4B', 'QKDSZQ6', 'QN4MLL5', 'QUSM82X', 'QVEY4VT', 'QX7LPCQ', 'QXREQ3B', 'RC7KTNK', 'RDS7B73', 'RFRCPK4', 'RH4ET7X', 'RJYGVLU', 'RKLNL15', 'RRJ2T3U', 'RWLQRMB', 'RX2ZKED', 'RX747GV', 'RYZLY7W', 'S2JK3BM', 'S33TGGR', 'S97URHS', 'S9LU3N1', 'SB6DMMV', 'SGGLEHG', 'SKXSKVN', 'SMD8AAC', 'SMVFHSN', 'SNGVWRA', 'SNN56P5', 'SPR6BNY', 'SR4KA4C', 'STC93KY', 'SUYZ8VU', 'SYYEUGK', 'T2AQVAX', 'T9NQGXC', 'TD11V4U', 'TJJUMH1', 'TLL43M5', 'TR51VSJ', 'TSC7CX6', 'U1V7NKC', 'U33NX8S', 'U9XEMPJ', 'UDURF2V', 'UELLB6G', 'UQNJ4PN', 'UT434P2', 'UYTCSHC', 'V23GV7S', 'V9NCCZN', 'VA62TJC', 'VAHGXAT', 'VC7FNUU', 'VCK3RS6', 'VELHHKT', 'VFTHSHR', 'VJXR22M', 'VNEF8XB', 'VQWCLBQ', 'VYAKNAS', 'VZT3Q4C', 'W4Z7KBH', 'W7G2L71', 'W7X9J5T', 'W8BFBFQ', 'WPXHTBM', 'WRNQXJE', 'WVD4APE', 'WWLQBRY', 'WYY6DFC', 'WZJUP51', 'X1V4LVF', 'X1YXFLS', 'X76K25N', 'X88T4K9', 'X98P8LX', 'XL7NXSA', 'XLJ3ZJF', 'XS8KLVJ', 'XT9W25Y', 'XWMQNDF', 'Y38ZJQC', 'Y7XTP7Q', 'Y923Y2B', 'YDSJCSY', 'YJCNAF9', 'YPR9H7D', 'YT99R7N', 'YVYCRK9', 'YYCN9RX', 'YZ5T7M3', 'Z19MPSS', 'Z59NV8M', 'Z7KG7VV', 'ZFL41Z3', 'ZGPUHR7', 'ZJA3MSH', 'ZUK6ZS2', 'ZVE5DBW', 'ZYARL1R')
        and p.day >= to_date(f.activation) 
        and p.day <= to_date(date_add(f.activation, 30))
;


select avg(total)
from (
    select sum(play_duration) total
    , p.user_id
    from playevent p
    join app_subscription a
    on p.user_id = a.user_id
    where day >= '2015-12-01'
    and day <= '2016-01-01'
    group by p.user_id
    ) a
;